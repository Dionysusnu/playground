<!DOCTYPE html>
<html>
	<head>
		<title>roblox-ts playground</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

		<link rel="stylesheet" href="style.css" />
		<link rel="shortcut icon" href="roblox-ts.png" />
	</head>

	<body>
		<script src="env.js"></script>
		<script src="https://unpkg.com/url-search-params@1.1.0/build/url-search-params.js"></script>
		<script src="https://unpkg.com/clipboard-polyfill@2.4.7/build/clipboard-polyfill.js"></script>
		<script src="https://unpkg.com/monaco-editor@0.15.6/min/vs/loader.js"></script>
		<script>
			const params = new URLSearchParams(location.search);

			window.CONFIG = {
				availableTSVersions: Object.assign(
					{},
					window.localTSVersion || {},
					{
						// https://unpkg.com/monaco-editor/
						"3.5.1": { monaco: "0.17.0" },
					},
					{},
				),

				extraLibs: [
					"https://unpkg.com/@rbxts/types@1.0.210/include/roblox.d.ts",
					// "https://unpkg.com/@rbxts/types@1.0.210/include/generated/PluginSecurity.d.ts",
					// "https://unpkg.com/@rbxts/types@1.0.210/include/generated/enums.d.ts",
					// "https://unpkg.com/@rbxts/types@1.0.210/include/es.d.ts",
					// "https://unpkg.com/@rbxts/types@1.0.210/include/lua.d.ts",
					// "https://unpkg.com/@rbxts/types@1.0.210/include/macro_math.d.ts",
				],

				baseUrl: location.protocol + "//" + location.host + location.pathname,

				getLatestVersion() {
					return Object.keys(this.availableTSVersions)
						.sort()
						.pop();
				},

				useTSVersion(version) {
					if (this.availableTSVersions[version]) {
						this.TSVersion = version;
					} else {
						alert(
							`Version '${version}' is not available, using ${this.TSVersion}`,
						);
					}
				},

				getMonacoVersion() {
					return this.availableTSVersions[this.TSVersion].monaco;
				},

				getAdditionalPaths() {
					const lib = this.availableTSVersions[this.TSVersion].lib;

					return lib
						? {
								"vs/language/typescript": `${this.baseUrl}${lib}`,
							}
						: {};
				},
			};

			window.CONFIG.TSVersion = window.CONFIG.getLatestVersion();
			console.log("window.CONFIG", window.CONFIG);

			if (params.has("ts")) {
				window.CONFIG.useTSVersion(params.get("ts"));
			}

			require.config({
				paths: Object.assign(
					{
						vs: `https://unpkg.com/monaco-editor@${window.CONFIG.getMonacoVersion()}/min/vs`,
					},
					window.CONFIG.getAdditionalPaths(),
				),
				ignoreDuplicateModules: ["vs/editor/editor.main"],
			});
		</script>
		<div id="app">
			<div class="flash flash--hidden">
				<span class="flash__message"></span>
			</div>

			<header>
				<div
					class="header-item"
					style="display: flex; flex-direction: row; align-items: center;"
				>
					<div
						class="spinner"
						style="margin-left: -0.5em; margin-right: 0.5em;"
					></div>
					<p>roblox-ts</p>
				</div>

				<div
					style="margin-left: 1em;"
					class="header-item header-item--extra-padding popup-on-hover"
					id="examples"
				>
					<p class="popup-header">Examples</p>
					<div class="popup" style="min-width: 20em;">
						<ul>
							<li class="button" data-example="classic-javascript">
								Classic JavaScript
							</li>
							<li class="button" data-example="adding-types">Adding Types</li>
							<li class="button" data-example="using-classes">Using Classes</li>
						</ul>
					</div>
				</div>
				<script>
					document
						.querySelector("#examples")
						.addEventListener("click", event => {
							if (event.target.matches("[data-example]")) {
								const exampleName = event.target.dataset.example;
								UI.selectExample(exampleName);
							}
						});
				</script>
			</header>
			<main id="playground">
				<section id="input"></section>
				<section id="output"></section>
			</main>
		</div>

		<script src="https://unpkg.com/lz-string@1.4.4/libs/lz-string.min.js"></script>
		<script src="main.js"></script>
		<script>
			require(["vs/editor/editor.main"], main);
		</script>
	</body>
</html>
